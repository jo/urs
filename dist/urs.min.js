/*! urs - v0.1.0 - 2013-04-11
* https://github.com/jo/urs
* Copyright (c) 2013 Johannes J. Schmidt; Licensed MIT */
(function(e){"use strict";function n(e){var n=document.getElementById("urs-style-"+e.element.id);n||(n=document.createElement("style"),n.id="urs-style-"+e.element.id,document.head.appendChild(n)),n.innerHTML="#"+e.element.id+" .urs-panel { width: "+200*e.panelSize+"%; }\n"+"#"+e.element.id+" img { max-width: "+100/e.panelSize+"%; }\n"+"#"+e.element.id+" .animate {\n"+"  -webkit-transition: -webkit-transform "+e.animationDuration+"ms ease-out;\n"+"  -moz-transition: -moz-transform "+e.animationDuration+"ms ease-out;\n"+"  -o-transition: -o-transform "+e.animationDuration+"ms ease-out;\n"+"  transition: transform "+e.animationDuration+"ms ease-out;\n"+"}"}function t(e,n){var t=document.createElement("div");t.className="urs-"+n;var a=new Image;a.src=S,a.className="urs-filling",t.appendChild(a);for(var i=0;i<e.panelSize;i++)a=new Image,t.appendChild(a);return t}function a(e){var n={};return n.panel=document.createElement("div"),n.panel.className="urs-panel",n.left=t(e,"left"),n.panel.appendChild(n.left),n.right=t(e,"right"),n.panel.appendChild(n.right),n}function i(e,n){var t=e.images.slice(Math.max(0,e.index-e.panelSize),e.index);t=e.images.slice(e.images.length-e.panelSize+t.length,e.images.length).concat(t);for(var a=0;a<t.length;a++)n.children[a+1].src=t[a]}function l(e,n){var t=e.images.slice(e.index,e.index+e.panelSize);t=t.concat(e.images.slice(0,e.panelSize-t.length));for(var a=0;a<t.length;a++)n.children[a+1].src=t[a]}function s(e,n){i(e,n.left),l(e,n.right),e.panelIndex=0}function o(e){return e.panel.panel.clientWidth*.5}function r(e,n){for(var t=[],a=[],i=1;i<e.panel.left.children.length;i++)a.push(e.panel.left.children[i].clientWidth);a.reverse();for(var l=0;l<a.length;l++)n+=a[l],t.push(n);return t.reverse()}function f(e,n){for(var t=[],a=1;a<e.panel.right.children.length;a++)t.push(n),n-=e.panel.right.children[a].clientWidth;return t}function d(e){var n=-o(e);e.offsets=r(e,n).concat(f(e,n))}function m(e){for(var n=0,t=e.offsets.length-1;t>=0&&(n=e.offsets[t],!(e.offset<n));t--);return n}function c(e){for(var n=0,t=0;t<e.offsets.length&&(n=e.offsets[t],!(e.offset>n));t++);return n}function u(e){e.offset=e.direction?c(e):m(e),e.panelIndex=e.offsets.indexOf(e.offset)-Math.floor(e.offsets.length/2),e.panelIndex>e.panelSize-1&&(e.panelIndex=e.panelSize-1),e.index=e.index+e.panelIndex,e.index>e.images.length-1&&(e.index=0),e.index<0&&(e.index=e.images.length-1)}function p(e){e.direction?e.panelIndex<e.panelSize-1&&(e.panelIndex++,e.index++,e.index>e.images.length-1&&(e.index=0)):e.panelIndex>-e.panelSize&&(e.panelIndex--,e.index--,e.index<0&&(e.index=e.images.length-1));var n=e.offsets.length/2+e.panelIndex;e.offset=e.offsets[n]}function h(e){var n="-webkit-transform: translate3d("+e.offset+"px,0,0)\n;"+"-moz-transform: translate3d("+e.offset+"px,0,0)\n;"+"-ms-transform: translate3d("+e.offset+"px,0,0)\n;"+"-o-transform: translate3d("+e.offset+"px,0,0)\n;"+"transform: translate3d("+e.offset+"px,0,0)";e.panel.panel.setAttribute("style",n)}function g(e){s(e,e.shadowPanel),e.shadowPanel.panel.removeAttribute("style"),e.element.appendChild(e.shadowPanel.panel);var n=e.panel;e.panel=e.shadowPanel,e.shadowPanel=n,e.offset=-o(e)}function x(e){e.switchTimeout&&clearTimeout(e.switchTimeout),e.panel.panel.className="urs-panel animate",h(e),e.switchTimeout=setTimeout(function(){g(e)},e.animationDuration)}function v(e,n){e.firstPositionX=0,e.lastX=0,e.lastMove=0,e.firstPositionX=n.pageX?n.pageX:n.touches&&n.touches.length&&n.touches[0].pageX,e.firstPositionX&&(n.preventDefault(),e.clicking=!0,e.lastX=e.firstPositionX)}function A(e,n){if(e.clicking){var t;t=n.pageX?n.pageX:n.touches&&n.touches.length&&n.touches[0].pageX,t&&(e.lastMove=t-e.lastX,e.offset=e.offset+e.lastMove,e.direction=e.lastX>t,e.lastX=t,h(e))}}function w(e){e.clicking=!1,d(e),e.lastMove?u(e):(e.direction=e.firstPositionX-e.element.offsetLeft>e.element.offsetLeft+e.element.clientWidth/2,p(e)),x(e)}function I(e,n,t){var a;if(e.attachEvent)for(a=0;a<n.length;a++)e.attachEvent("on"+n[a],t);else for(a=0;a<n.length;a++)e.addEventListener(n[a],t,!1)}var z=1,S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=";e.urs=function(e){if(e=e||{},e.animationDuration=e.animationDuration||200,e.panelSize=e.panelSize||2,e.images=e.images||[],typeof e.element=="string"&&(e.element=document.getElementById(e.element)),!(e.element instanceof HTMLElement))throw"options.element is not a DOM node";e.element.id=e.element.id||"urs-slider-"+z++,e.element.className.split(" ").indexOf("urs-slider")===-1&&(e.element.className=e.element.className?e.element.className+" urs-slider":"urs-slider"),e.style=n(e),e.shadowPanel=a(e),e.element.appendChild(e.shadowPanel.panel),e.panel=a(e),e.element.appendChild(e.panel.panel),e.offset=-o(e),e.index=0,s(e,e.panel),I(e.element,["mousedown","touchstart"],function(n){v(e,n)}),I(e.element,["mousemove","touchmove"],function(n){A(e,n)}),I(e.element,["mouseup","touchend","touchcancel"],function(n){w(e,n)})}})("object"==typeof exports&&exports||this);